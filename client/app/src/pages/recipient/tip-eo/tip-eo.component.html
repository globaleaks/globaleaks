<div class="reveal">
    <div id="Toolbar" class="row">
        <div class="col-md-12">
            <a id="link-tiplist" href="#/recipient/reports" data-toggle="tooltip" title="{{'Reports' | translate}}"
                class="btn btn-outline-secondary">
                <i class="fa-solid fa-arrow-left"></i>
            </a>

            <span id="tip-action-star" (click)="tipToggleStar()" data-toggle="tooltip"
                title="{{'Mark as important' | translate}}" class="btn btn-outline-secondary">
                <i class="fa-solid fa-star" [ngClass]="{'text-warning': tip && tip.important}"></i>
            </span>
            <span id="tip-action-reminder" (click)="setReminder()" data-toggle="tooltip"
                title="{{'Set a reminder' | translate}}" class="btn btn-outline-secondary">
                <i class="fa-solid" [ngClass]="{'fa-bell': !utils.isNever(tip.reminder_date), 'fa-bell-slash': tip && utils.isNever(tip.reminder_date), 'text-warning': tip && utils.isDatePassed(tip.reminder_date)}"></i>
            </span>

            <span id="tip-action-notify" *ngIf="tip && !tip.enable_notifications" (click)="tipNotify(true)"
                data-toggle="tooltip" title="{{'Turn on email notifications' | translate}}"
                class="btn btn-outline-secondary active">
                <i class="fa-solid fa-volume-mute"></i>
            </span>
            <span id="tip-action-silence" *ngIf="!tip || tip.enable_notifications" (click)="tipNotify(false)"
                data-toggle="tooltip" title="{{'Silence email notifications' | translate}}"
                class="btn btn-outline-secondary">
                <i class="fa-solid fa-volume-down"></i>
            </span>

            <span id="tip-action-grant-access" *ngIf="preferencesService.dataModel.can_grant_access_to_reports"
                (click)="openGrantTipAccessModal()" data-toggle="tooltip" title="{{'Grant access' | translate}}"
                class="btn btn-outline-secondary">
                <i class="fa-solid fa-user-plus"></i>
            </span>
            <span id="tip-action-revoke-access" *ngIf="preferencesService.dataModel.can_grant_access_to_reports"
                (click)="openRevokeTipAccessModal()" data-toggle="tooltip" title="{{'Revoke access' | translate}}"
                class="btn btn-outline-secondary">
                <i class="fa-solid fa-user-minus"></i>
            </span>
            <span id="tip-action-transfer-access" *ngIf="preferencesService.dataModel.can_transfer_access_to_reports"
                (click)="openTipTransferModal()" data-toggle="tooltip" title="{{'Transfer access' | translate}}"
                class="btn btn-outline-secondary">
                <i class="fa-solid fa-people-arrows"></i>
            </span>

            <span id="tip-action-print" (click)="utils.print()" data-toggle="tooltip" title="{{'Print' | translate}}"
                class="btn btn-outline-secondary">
                <i class="fa-solid fa-print"></i>
            </span>

            <span id="link-reload" (click)="reload()" data-toggle="tooltip" title="{{'Refresh' | translate}}"
                class="btn btn-outline-secondary">
                <i class="fa-solid fa-sync"></i>
            </span>
        </div>
    </div>
    <div class="row mt-2">
        <div class="col-md-12">
            <src-tip-info [loading]="loading" [tipService]="RTipService"></src-tip-info>
        </div>
    </div>
    <ng-container *ngIf="tip && tip.receivers">
        <div class="row" *ngIf="tip.receivers.length > 1">
            <div class="col-md-12">
                <src-tip-receiver-list [tipService]="RTipService"></src-tip-receiver-list>
            </div>
        </div>
    </ng-container>
    <div class="row">
        <div class="col-md-6">
            <div id="TextCard" class="card card-default">
                <div class="card-header d-flex justify-content-between">
                    <span>Text</span>
                </div>
                <div class="card-body">
                    <span>{{questionnaireData.textareaAnswer}}</span>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            
                <src-sendtip-detail-questionnaire-answers *ngIf="tip.status==='closed'" [questionnaire]="tip.questionnaires[0]" 
                 [label]="'Form Istruttoria'"></src-sendtip-detail-questionnaire-answers>

                <src-tip-eo-form *ngIf="tip.status!=='closed'" (notifyFileUpload)="notifyFileUpload($event)" 
                (sumbitFormEvent)="closeForwardedReport()" [fields]="questionnaireData.reviewFormFields" [fieldAnswers]="answers" [tipStatus]="tip.status" [displayErrors]="true"></src-tip-eo-form>

        </div>
    </div>                  
    <ul ngbNav #nav="ngbNav" class="nav-tabs" [(activeId)]="active">
        <ng-container *ngFor="let tab of tabs">
            <li [ngbNavItem]="tab.title">
                <button ngbNavLink>{{ tab.title | translate }}</button>
                <ng-template ngbNavContent>
                    <ng-container *ngTemplateOutlet="tab.component"></ng-container>
                </ng-template>
            </li>
        </ng-container>
    </ul>
    <div [ngbNavOutlet]="nav" class="mt-2"></div>
    <div class="row">
        <ng-template #tab1>
            <div class="col-md-12">

                <src-tip-files-receiver [forwardings]="tip.forwardings"></src-tip-files-receiver>

                <ng-container *ngIf="tip && tip.context">
                    <src-tip-comments [tipService]="RTipService" [key]="'whistleblower'" 
                    [maximum_number]="preferencesService.dataModel.t_affiliated ? appDataService.public.node.max_msg_external_to_whistle : appDataService.public.node.max_msg_external_to_whistle_not_aff"
                    [placeholder]="'Insert here a comment for the WhistleBlower. Don\'t ask questions, this comment cannot be replied.'"></src-tip-comments>
                </ng-container>
            </div>
        </ng-template>
        <ng-template #tab2>
            <div class="col-md-12">

                <src-tip-eo-rfiles-receiver [key]="'eo'"></src-tip-eo-rfiles-receiver>

                <ng-container *ngIf="tip && tip.context">
                    <src-tip-comments [tipService]="RTipService" [key]="'eo'" [tids]="[preferencesService.dataModel.tid]" ></src-tip-comments>
                </ng-container>
            </div>
        </ng-template>
        <ng-template #tab3>
            <div class="col-md-12">

                <src-tip-upload-wbfile [tip]="tip" (dataToParent)="listenToFields()"
                    [key]="'internal'"></src-tip-upload-wbfile>

                <ng-container *ngIf="tip && tip.context">
                    <src-tip-comments [tipService]="RTipService"  [key]="'internal'"></src-tip-comments>
                </ng-container>
            </div>
        </ng-template>
        <ng-template #tab4>
            <div class="col-md-12">
                
                <src-tip-upload-wbfile [tip]="tip" (dataToParent)="listenToFields()"
                [key]="'personal'"></src-tip-upload-wbfile>

                <ng-container *ngIf="tip && tip.context">
                    <src-tip-comments [tipService]="RTipService" [key]="'personal'"></src-tip-comments>
                </ng-container>
            </div>
        </ng-template>
    </div>
</div>
